version: 1
deploy:
    steps:
        terraformInit:
          before:
            - apt-get install sudo -y
            - curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.deb.sh | sudo bash
            - sudo apt-get install git-lfs
            - mkdir without
            - cd without
            - git lfs install
            - git clone https://github.com/RLRabinowitz/repo-with-large-file-storage
            - cd repo-with-large-file-storage
            - git checkout master
            - git submodule update --init --recursive --jobs 2
            - cd ../..
          after:
            - mkdir with
            - cd with
            - git lfs install
            - git clone https://github.com/RLRabinowitz/repo-with-large-file-storage --no-single-branch --depth=1
            - cd repo-with-large-file-storage
            - git fetch --prune --no-recurse-submodules --depth=1 origin master
            - git checkout master
            - git submodule update --depth=1 --init --recursive --jobs 2
            - cd ../..
